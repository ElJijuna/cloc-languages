name: Web Audit Report
on:
  workflow_dispatch:
    inputs:
      runtime:
        description: 'Runtime to execute report audit, values: npm | bun | pnpm | yarn'
        default: 'npm'
        required: true
        type: string
jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ“¥ Clonar el repositorio
      uses: actions/checkout@v3
    - name: ðŸ”§ Instalar dependencias con npm ci
      run: npm ci
    - name: ðŸ§¨ Executing Script...
      run: curl https://raw.githubusercontent.com/ElJijuna/Bash-Scripts/refs/heads/main/web-audit-report.sh | bash -s npm
    - name: ðŸ“‚ Verify repository content
      run: ls -l
    - name: ðŸ“¦ Save report
      uses: actions/upload-artifact@v4
      with:
        name: audit-report
        path: cloc_languages.json
  sends-report:
    runs-on: ubuntu-latest
    needs: audit
    steps:
    - name: ðŸ“¥ Download artifact
      uses: actions/download-artifact@v4
      with:
        name: audit-report
    - name: ðŸ“¥ Cloning
      run: |
        git clone --depth 1 https://github.com/ElJijuna/Npm-Audit-Reports.git
        ls -la ${{ github.workspace }}
    - name: ðŸ“¦ Copy report
      run: |
        cp ${{ github.workspace }}/cloc_languages.json Npm-Audit-Reports/cloc_languages.json
        cd Npm-Audit-Reports
    - name: âœ… Commit & Push
      run: |
        git add cloc_languages.json
        git commit -m "ðŸ“Š Nuevo reporte desde workflow"
        git push
