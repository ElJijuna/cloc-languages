name: Web Audit Report
on:
  workflow_dispatch:
    inputs:
      runtime:
        description: 'Runtime to execute report audit, values: npm | bun | pnpm | yarn'
        default: 'npm'
        required: true
        type: string
jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ“¥ Clonar el repositorio
      uses: actions/checkout@v3
    - name: ðŸ”§ Instalar dependencias con npm ci
      run: npm ci
    - name: ðŸ§¨ Executing Script...
      run: curl https://raw.githubusercontent.com/ElJijuna/Bash-Scripts/refs/heads/main/web-audit-report.sh | bash -s npm
    - name: ðŸ“‚ Verify repository content
      run: ls -l
    - name: ðŸ“¦ Save report
      uses: actions/upload-artifact@v4
      with:
        name: audit-report
        path: cloc-languages--web-audit.json
  publish-report:
    runs-on: ubuntu-latest
    needs: audit
    steps:
    - name: ðŸ“¥ Cloning
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git clone --depth 1 https://x-access-token:${{ secrets.MONITORING_TOOL_DB }}@github.com/ElJijuna/MonitoringTool-DB.git .
    - name: ðŸ“¥ Download artifact
      uses: actions/download-artifact@v4
      with:
        name: audit-report
    - name: ðŸ“‚ Verify repository content
      run: ls -l
    - name: âœ… Commit & Push
      run: |
        git add cloc-languages--web-audit.json
        git commit -m "ðŸ“Š Update report"
        git push
  publish-report-versions:
    runs-on: ubuntu-latest
    needs: publish-report
    steps:
    - name: ðŸ“¥ Cloning
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git clone --depth 1 https://x-access-token:${{ secrets.MONITORING_TOOL_DB }}@github.com/ElJijuna/MonitoringTool-DB.git .
    - name: ðŸ“‚ Verify repository content
      run: ls -l
    - name: ðŸ§¨ Executing Script...
      run: curl https://raw.githubusercontent.com/ElJijuna/Bash-Scripts/refs/heads/main/web-audit-versions.sh | bash -s cloc-languages--web-audit
    - name: ðŸ“‚ Verify repository content
      run: ls -l
    - name: âœ… Commit & Push
      run: |
        git add cloc-languages--web-audit--versions.json
        git commit -m "ðŸ“Š Update report versions"
        git push
      

